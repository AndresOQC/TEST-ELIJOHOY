import{d as S,a as Q,o as z,w as i,V as E,r as d,s as y,O as N,X as L,h as r,f as s,P as f,S as m,i as n,Y as t,Q as p,U as V,aA as $,j as A}from"./index-Cuq-20sr.js";import{Q as I}from"./QSelect-BcAlhhQy.js";import{Q as C}from"./QForm-DniIt7pX.js";import{Q as B}from"./QPage-BbETI0eO.js";import{C as M}from"./ClosePopup-hB_z_enV.js";import{u as G}from"./use-quasar-BQEaEESb.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-BidYe6Ey.js";import"./QItem-Wn0KzBN4.js";import"./QMenu-BbkonhRD.js";import"./position-engine-DLgvu9FR.js";import"./selection-D1SZ-GK8.js";import"./format-BvkBI9bc.js";const R=S({name:"ConfiguracionesPage",setup(){const e=G(),o=L(),u=E(),c=d({nombre:"",apellidos:"",edad:null,genero:null,email:"",ciudad:"",pais:"",institucion_educativa:"",grado:"",seccion:"",turno:""}),w=d({current_password:"",new_password:"",confirm_password:""}),g=d(!1),l=d(!1),h=d(!1),F=d(!1),v=d(!1),b=d(!1),P=y(()=>u.user||{}),q=y(()=>[a=>!!a||"La contraseña es requerida",a=>a.length>=8||"Mínimo 8 caracteres",a=>/[A-Z]/.test(a)||"Debe contener al menos una mayúscula",a=>/[a-z]/.test(a)||"Debe contener al menos una minúscula",a=>/[0-9]/.test(a)||"Debe contener al menos un número",a=>/[!@#$%^&*(),.?":{}|<>]/.test(a)||"Debe contener al menos un símbolo"]),U=a=>a?new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"No disponible",k=async()=>{v.value=!0;try{const a=await u.updateProfile(c.value);a.success?e.notify({message:"Perfil actualizado exitosamente",color:"positive",icon:"check"}):e.notify({message:a.message,color:"negative",icon:"error"})}catch(a){console.error("Update profile error:",a),e.notify({message:"Error actualizando el perfil",color:"negative",icon:"error"})}finally{v.value=!1}},_=async()=>{b.value=!0;try{await new Promise(a=>setTimeout(a,1e3)),e.notify({message:"Contraseña cambiada exitosamente",color:"positive",icon:"check"}),g.value=!1,w.value={current_password:"",new_password:"",confirm_password:""}}catch(a){console.error("Change password error:",a),e.notify({message:"Error cambiando la contraseña",color:"negative",icon:"error"})}finally{b.value=!1}},D=async()=>{e.dialog({title:"Cerrar Sesión",message:"¿Estás seguro que deseas cerrar sesión?",cancel:!0,persistent:!0}).onOk(async()=>{try{await u.logout(),e.notify({message:"Sesión cerrada exitosamente",color:"positive",icon:"check"}),o.push("/")}catch(a){console.error("Logout error:",a)}})};return N(()=>{if(u.user){const a=u.user.alumno||{};c.value={nombre:a.nombre||"",apellidos:a.apellidos||"",edad:a.edad||null,genero:a.genero||null,email:u.user.email||"",ciudad:a.ciudad||"",pais:a.pais||"",institucion_educativa:a.institucion_educativa||"",grado:a.grado||"",seccion:a.seccion||"",turno:a.turno||""}}}),{profileForm:c,passwordForm:w,showPasswordDialog:g,showCurrentPassword:l,showNewPassword:h,showConfirmPassword:F,profileLoading:v,passwordLoading:b,user:P,passwordRules:q,formatDate:U,updateProfile:k,changePassword:_,logout:D}}}),j={class:"row q-gutter-lg"},T={class:"col-12 col-md-8"},X={class:"row items-center q-mb-md"},Y={class:"row q-gutter-md"},Z={class:"col-12 col-sm-6"},H={class:"col-12 col-sm-6"},J={class:"row q-gutter-md"},K={class:"col-12 col-sm-6"},W={class:"col-12 col-sm-6"},x={class:"row q-gutter-md"},ee={class:"col-12 col-sm-6"},oe={class:"col-12 col-sm-6"},se={class:"row q-gutter-md"},le={class:"col-12 col-sm-6"},re={class:"col-12 col-sm-6"},ae={class:"row q-gutter-md"},ie={class:"col-12 col-sm-4"},ne={class:"col-12 col-sm-4"},te={class:"col-12 col-sm-4"},de={class:"text-right"},ue={class:"col-12 col-md-4"},me={class:"row items-center q-mb-md"},pe={class:"q-gutter-sm"},ce={class:"q-gutter-sm"},fe={class:"row items-center"},we={class:"row items-center"},ge={class:"row items-center"},ve={class:"row q-gutter-sm justify-end"};function be(e,o,u,c,w,g){return z(),Q(B,{class:"configuraciones-page q-pa-lg"},{default:i(()=>[r("div",j,[o[23]||(o[23]=r("div",{class:"col-12"},[r("div",{class:"page-header"},[r("h1",{class:"text-h4 text-weight-bold text-primary q-mb-sm"}," Configuraciones "),r("p",{class:"text-body1 text-grey-7"}," Administra tu perfiL ")])],-1)),r("div",T,[s(f,{class:"profile-card",flat:"",bordered:""},{default:i(()=>[s(m,null,{default:i(()=>[r("div",X,[s(n,{name:"person",size:"32px",color:"primary",class:"q-mr-sm"}),o[19]||(o[19]=r("div",{class:"text-h6 text-weight-bold"},"Información del Perfil",-1))]),s(C,{onSubmit:e.updateProfile,class:"q-gutter-md"},{default:i(()=>[r("div",Y,[r("div",Z,[s(t,{modelValue:e.profileForm.nombre,"onUpdate:modelValue":o[0]||(o[0]=l=>e.profileForm.nombre=l),label:"Nombre",outlined:"",color:"purple-7",rules:[l=>!!l||"El nombre es requerido"],"lazy-rules":""},{prepend:i(()=>[s(n,{name:"badge",color:"purple-7"})]),_:1},8,["modelValue","rules"])]),r("div",H,[s(t,{modelValue:e.profileForm.apellidos,"onUpdate:modelValue":o[1]||(o[1]=l=>e.profileForm.apellidos=l),label:"Apellidos",outlined:"",color:"purple-7",rules:[l=>!!l||"Los apellidos son requeridos"],"lazy-rules":""},{prepend:i(()=>[s(n,{name:"badge",color:"purple-7"})]),_:1},8,["modelValue","rules"])])]),r("div",J,[r("div",K,[s(t,{modelValue:e.profileForm.email,"onUpdate:modelValue":o[2]||(o[2]=l=>e.profileForm.email=l),label:"Correo Electrónico",type:"email",outlined:"",readonly:"",color:"purple-7",hint:"El email no se puede modificar"},{prepend:i(()=>[s(n,{name:"email",color:"purple-7"})]),_:1},8,["modelValue"])]),r("div",W,[s(t,{modelValue:e.profileForm.edad,"onUpdate:modelValue":o[3]||(o[3]=l=>e.profileForm.edad=l),type:"number",label:"Edad",outlined:"",color:"purple-7",rules:[l=>!!l||"La edad es requerida",l=>l>0||"Edad inválida"],"lazy-rules":""},{prepend:i(()=>[s(n,{name:"cake",color:"purple-7"})]),_:1},8,["modelValue","rules"])])]),r("div",x,[r("div",ee,[s(I,{modelValue:e.profileForm.genero,"onUpdate:modelValue":o[4]||(o[4]=l=>e.profileForm.genero=l),options:["Masculino","Femenino","Otro"],label:"Género",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"wc",color:"purple-7"})]),_:1},8,["modelValue"])]),r("div",oe,[s(t,{modelValue:e.profileForm.ciudad,"onUpdate:modelValue":o[5]||(o[5]=l=>e.profileForm.ciudad=l),label:"Ciudad",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"location_city",color:"purple-7"})]),_:1},8,["modelValue"])])]),r("div",se,[r("div",le,[s(t,{modelValue:e.profileForm.pais,"onUpdate:modelValue":o[6]||(o[6]=l=>e.profileForm.pais=l),label:"País",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"public",color:"purple-7"})]),_:1},8,["modelValue"])]),r("div",re,[s(t,{modelValue:e.profileForm.institucion_educativa,"onUpdate:modelValue":o[7]||(o[7]=l=>e.profileForm.institucion_educativa=l),label:"Institución Educativa",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"school",color:"purple-7"})]),_:1},8,["modelValue"])])]),r("div",ae,[r("div",ie,[s(t,{modelValue:e.profileForm.grado,"onUpdate:modelValue":o[8]||(o[8]=l=>e.profileForm.grado=l),label:"Grado",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"grade",color:"purple-7"})]),_:1},8,["modelValue"])]),r("div",ne,[s(t,{modelValue:e.profileForm.seccion,"onUpdate:modelValue":o[9]||(o[9]=l=>e.profileForm.seccion=l),label:"Sección",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"class",color:"purple-7"})]),_:1},8,["modelValue"])]),r("div",te,[s(t,{modelValue:e.profileForm.turno,"onUpdate:modelValue":o[10]||(o[10]=l=>e.profileForm.turno=l),label:"Turno",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"schedule",color:"purple-7"})]),_:1},8,["modelValue"])])]),r("div",de,[s(p,{unelevated:"",type:"submit",color:"primary",label:"Guardar Cambios",icon:"save",loading:e.profileLoading,"no-caps":""},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),r("div",ue,[s(f,{class:"account-card",flat:"",bordered:""},{default:i(()=>[s(m,null,{default:i(()=>[r("div",me,[s(n,{name:"security",size:"32px",color:"secondary",class:"q-mr-sm"}),o[20]||(o[20]=r("div",{class:"text-h6 text-weight-bold"},"Configuración de Cuenta",-1))]),r("div",pe,[s(p,{outline:"",color:"primary",icon:"lock",label:"Cambiar Contraseña",onClick:o[11]||(o[11]=l=>e.showPasswordDialog=!0),class:"full-width","no-caps":""}),s(p,{outline:"",color:"negative",icon:"logout",label:"Cerrar Sesión",onClick:e.logout,class:"full-width","no-caps":""},null,8,["onClick"])])]),_:1})]),_:1}),s(f,{class:"status-card q-mt-md",flat:"",bordered:""},{default:i(()=>[s(m,null,{default:i(()=>[o[22]||(o[22]=r("div",{class:"text-h6 text-weight-bold q-mb-md"},"Estado de la Cuenta",-1)),r("div",ce,[r("div",fe,[s(n,{name:e.user.email_verificado?"verified":"error",color:e.user.email_verificado?"positive":"negative",class:"q-mr-sm"},null,8,["name","color"]),r("span",null,"Email "+V(e.user.email_verificado?"Verificado":"No Verificado"),1)]),r("div",we,[s(n,{name:"check_circle",color:"positive",class:"q-mr-sm"}),o[21]||(o[21]=r("span",null,"Cuenta Activa",-1))]),r("div",ge,[s(n,{name:"schedule",color:"info",class:"q-mr-sm"}),r("span",null,"Miembro desde "+V(e.formatDate(e.user.creado_en)),1)])])]),_:1})]),_:1})])]),s($,{modelValue:e.showPasswordDialog,"onUpdate:modelValue":o[18]||(o[18]=l=>e.showPasswordDialog=l)},{default:i(()=>[s(f,{style:{"min-width":"400px"}},{default:i(()=>[s(m,{class:"row items-center"},{default:i(()=>[s(n,{name:"lock",size:"32px",color:"primary",class:"q-mr-sm"}),o[24]||(o[24]=r("span",{class:"text-h6"},"Cambiar Contraseña",-1))]),_:1}),s(m,null,{default:i(()=>[s(C,{onSubmit:e.changePassword,class:"q-gutter-md"},{default:i(()=>[s(t,{modelValue:e.passwordForm.current_password,"onUpdate:modelValue":o[13]||(o[13]=l=>e.passwordForm.current_password=l),type:e.showCurrentPassword?"text":"password",label:"Contraseña Actual",outlined:"",rules:[l=>!!l||"Ingresa tu contraseña actual"],"lazy-rules":""},{append:i(()=>[s(n,{name:e.showCurrentPassword?"visibility":"visibility_off",class:"cursor-pointer",onClick:o[12]||(o[12]=l=>e.showCurrentPassword=!e.showCurrentPassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),s(t,{modelValue:e.passwordForm.new_password,"onUpdate:modelValue":o[15]||(o[15]=l=>e.passwordForm.new_password=l),type:e.showNewPassword?"text":"password",label:"Nueva Contraseña",outlined:"",rules:e.passwordRules,"lazy-rules":""},{append:i(()=>[s(n,{name:e.showNewPassword?"visibility":"visibility_off",class:"cursor-pointer",onClick:o[14]||(o[14]=l=>e.showNewPassword=!e.showNewPassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),s(t,{modelValue:e.passwordForm.confirm_password,"onUpdate:modelValue":o[17]||(o[17]=l=>e.passwordForm.confirm_password=l),type:e.showConfirmPassword?"text":"password",label:"Confirmar Nueva Contraseña",outlined:"",rules:[l=>!!l||"Confirma la nueva contraseña",l=>l===e.passwordForm.new_password||"Las contraseñas no coinciden"],"lazy-rules":""},{append:i(()=>[s(n,{name:e.showConfirmPassword?"visibility":"visibility_off",class:"cursor-pointer",onClick:o[16]||(o[16]=l=>e.showConfirmPassword=!e.showConfirmPassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),r("div",ve,[A(s(p,{flat:"",label:"Cancelar",color:"grey"},null,512),[[M]]),s(p,{unelevated:"",type:"submit",label:"Cambiar",color:"primary",loading:e.passwordLoading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ee=O(R,[["render",be],["__scopeId","data-v-2ca6d326"]]);export{Ee as default};
