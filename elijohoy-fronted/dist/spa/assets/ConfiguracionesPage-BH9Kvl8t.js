import{d as S,a as z,o as E,w as i,L,r as m,B as V,H as N,M as $,h as l,f as s,I as w,J as p,i as n,O as d,Q as c,K as C,am as I,j as A}from"./index-FQbhSSz1.js";import{Q as M}from"./QSelect-Lg6ai8MX.js";import{Q as h}from"./QForm-BlhfreVu.js";import{Q as B}from"./QPage-DPta7qzB.js";import{C as G}from"./ClosePopup-Cw7Yecj0.js";import{u as O}from"./use-quasar-BN2GYftC.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-ClphmnYD.js";import"./QItem-QYqobo8h.js";import"./QMenu-BelHDkCR.js";import"./position-engine-HYe-1gGR.js";import"./selection-B9H5g_ok.js";import"./format-BvkBI9bc.js";const j=S({name:"ConfiguracionesPage",setup(){const e=O(),o=$(),t=L(),f=m({nombre:"",apellidos:"",edad:null,genero:null,email:"",ciudad:"",pais:"",institucion_educativa:"",grado:"",seccion:"",turno:""}),g=m({current_password:"",new_password:"",confirm_password:""}),v=m(!1),r=m(!1),F=m(!1),P=m(!1),b=m(!1),y=m(!1),q=V(()=>t.user||{}),k=V(()=>[a=>!!a||"La contraseña es requerida",a=>a.length>=8||"Mínimo 8 caracteres",a=>/[A-Z]/.test(a)||"Debe contener al menos una mayúscula",a=>/[a-z]/.test(a)||"Debe contener al menos una minúscula",a=>/[0-9]/.test(a)||"Debe contener al menos un número",a=>/[!@#$%^&*(),.?":{}|<>]/.test(a)||"Debe contener al menos un símbolo"]),D=a=>a?new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"No disponible",U=async()=>{b.value=!0;try{const a={...f.value};a.genero&&(a.genero=a.genero.toLowerCase());const u=await t.updateProfile(a);u.success?e.notify({message:"Perfil actualizado exitosamente",color:"positive",icon:"check"}):e.notify({message:u.message,color:"negative",icon:"error"})}catch(a){console.error("Update profile error:",a),e.notify({message:"Error actualizando el perfil",color:"negative",icon:"error"})}finally{b.value=!1}},_=async()=>{y.value=!0;try{await new Promise(a=>setTimeout(a,1e3)),e.notify({message:"Contraseña cambiada exitosamente",color:"positive",icon:"check"}),v.value=!1,g.value={current_password:"",new_password:"",confirm_password:""}}catch(a){console.error("Change password error:",a),e.notify({message:"Error cambiando la contraseña",color:"negative",icon:"error"})}finally{y.value=!1}},Q=async()=>{e.dialog({title:"Cerrar Sesión",message:"¿Estás seguro que deseas cerrar sesión?",cancel:!0,persistent:!0}).onOk(async()=>{try{await t.logout(),e.notify({message:"Sesión cerrada exitosamente",color:"positive",icon:"check"}),o.push("/")}catch(a){console.error("Logout error:",a)}})};return N(()=>{if(t.user){const a=u=>u?u==="masculino"?"Masculino":u==="femenino"?"Femenino":u==="otro"?"Otro":u:null;f.value={nombre:t.user.nombre||"",apellidos:t.user.apellidos||"",edad:t.user.edad||null,genero:a(t.user.genero)||null,email:t.user.email||"",ciudad:t.user.ciudad||"",pais:t.user.pais||"",institucion_educativa:t.user.institucion_educativa||"",grado:t.user.grado||"",seccion:t.user.seccion||"",turno:t.user.turno||""}}}),{profileForm:f,passwordForm:g,showPasswordDialog:v,showCurrentPassword:r,showNewPassword:F,showConfirmPassword:P,profileLoading:b,passwordLoading:y,user:q,passwordRules:k,formatDate:D,updateProfile:U,changePassword:_,logout:Q}}}),T={class:"row q-gutter-lg"},H={class:"col-12 col-md-8"},J={class:"row items-center q-mb-md"},K={class:"row q-gutter-md"},Z={class:"col-12 col-sm-6"},W={class:"col-12 col-sm-6"},X={class:"row q-gutter-md"},Y={class:"col-12 col-sm-6"},x={class:"col-12 col-sm-6"},ee={class:"row q-gutter-md"},oe={class:"col-12 col-sm-6"},se={class:"col-12 col-sm-6"},re={class:"row q-gutter-md"},le={class:"col-12 col-sm-6"},ae={class:"col-12 col-sm-6"},ie={class:"row q-gutter-md"},ne={class:"col-12 col-sm-4"},te={class:"col-12 col-sm-4"},de={class:"col-12 col-sm-4"},ue={class:"text-right"},me={class:"col-12 col-md-4"},pe={class:"row items-center q-mb-md"},ce={class:"q-gutter-sm"},fe={class:"q-gutter-sm"},we={class:"row items-center"},ge={class:"row items-center"},ve={class:"row items-center"},be={class:"row q-gutter-sm justify-end"};function ye(e,o,t,f,g,v){return E(),z(B,{class:"configuraciones-page q-pa-lg"},{default:i(()=>[l("div",T,[o[23]||(o[23]=l("div",{class:"col-12"},[l("div",{class:"page-header"},[l("h1",{class:"text-h4 text-weight-bold text-primary q-mb-sm"}," Configuraciones "),l("p",{class:"text-body1 text-grey-7"}," Administra tu perfil ")])],-1)),l("div",H,[s(w,{class:"profile-card",flat:"",bordered:""},{default:i(()=>[s(p,null,{default:i(()=>[l("div",J,[s(n,{name:"person",size:"32px",color:"primary",class:"q-mr-sm"}),o[19]||(o[19]=l("div",{class:"text-h6 text-weight-bold"},"Información del Perfil",-1))]),s(h,{onSubmit:e.updateProfile,class:"q-gutter-md"},{default:i(()=>[l("div",K,[l("div",Z,[s(d,{modelValue:e.profileForm.nombre,"onUpdate:modelValue":o[0]||(o[0]=r=>e.profileForm.nombre=r),label:"Nombre",outlined:"",color:"purple-7",rules:[r=>!!r||"El nombre es requerido"],"lazy-rules":""},{prepend:i(()=>[s(n,{name:"badge",color:"purple-7"})]),_:1},8,["modelValue","rules"])]),l("div",W,[s(d,{modelValue:e.profileForm.apellidos,"onUpdate:modelValue":o[1]||(o[1]=r=>e.profileForm.apellidos=r),label:"Apellidos",outlined:"",color:"purple-7",rules:[r=>!!r||"Los apellidos son requeridos"],"lazy-rules":""},{prepend:i(()=>[s(n,{name:"badge",color:"purple-7"})]),_:1},8,["modelValue","rules"])])]),l("div",X,[l("div",Y,[s(d,{modelValue:e.profileForm.email,"onUpdate:modelValue":o[2]||(o[2]=r=>e.profileForm.email=r),label:"Correo Electrónico",type:"email",outlined:"",readonly:"",color:"purple-7",hint:"El email no se puede modificar"},{prepend:i(()=>[s(n,{name:"email",color:"purple-7"})]),_:1},8,["modelValue"])]),l("div",x,[s(d,{modelValue:e.profileForm.edad,"onUpdate:modelValue":o[3]||(o[3]=r=>e.profileForm.edad=r),type:"number",label:"Edad",outlined:"",color:"purple-7",rules:[r=>!!r||"La edad es requerida",r=>r>0||"Edad inválida"],"lazy-rules":""},{prepend:i(()=>[s(n,{name:"cake",color:"purple-7"})]),_:1},8,["modelValue","rules"])])]),l("div",ee,[l("div",oe,[s(M,{modelValue:e.profileForm.genero,"onUpdate:modelValue":o[4]||(o[4]=r=>e.profileForm.genero=r),options:["Masculino","Femenino","Otro"],label:"Género",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"wc",color:"purple-7"})]),_:1},8,["modelValue"])]),l("div",se,[s(d,{modelValue:e.profileForm.ciudad,"onUpdate:modelValue":o[5]||(o[5]=r=>e.profileForm.ciudad=r),label:"Ciudad",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"location_city",color:"purple-7"})]),_:1},8,["modelValue"])])]),l("div",re,[l("div",le,[s(d,{modelValue:e.profileForm.pais,"onUpdate:modelValue":o[6]||(o[6]=r=>e.profileForm.pais=r),label:"País",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"public",color:"purple-7"})]),_:1},8,["modelValue"])]),l("div",ae,[s(d,{modelValue:e.profileForm.institucion_educativa,"onUpdate:modelValue":o[7]||(o[7]=r=>e.profileForm.institucion_educativa=r),label:"Institución Educativa",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"school",color:"purple-7"})]),_:1},8,["modelValue"])])]),l("div",ie,[l("div",ne,[s(d,{modelValue:e.profileForm.grado,"onUpdate:modelValue":o[8]||(o[8]=r=>e.profileForm.grado=r),label:"Grado",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"grade",color:"purple-7"})]),_:1},8,["modelValue"])]),l("div",te,[s(d,{modelValue:e.profileForm.seccion,"onUpdate:modelValue":o[9]||(o[9]=r=>e.profileForm.seccion=r),label:"Sección",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"class",color:"purple-7"})]),_:1},8,["modelValue"])]),l("div",de,[s(d,{modelValue:e.profileForm.turno,"onUpdate:modelValue":o[10]||(o[10]=r=>e.profileForm.turno=r),label:"Turno",outlined:"",color:"purple-7"},{prepend:i(()=>[s(n,{name:"schedule",color:"purple-7"})]),_:1},8,["modelValue"])])]),l("div",ue,[s(c,{unelevated:"",type:"submit",color:"primary",label:"Guardar Cambios",icon:"save",loading:e.profileLoading,"no-caps":""},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),l("div",me,[s(w,{class:"account-card",flat:"",bordered:""},{default:i(()=>[s(p,null,{default:i(()=>[l("div",pe,[s(n,{name:"security",size:"32px",color:"secondary",class:"q-mr-sm"}),o[20]||(o[20]=l("div",{class:"text-h6 text-weight-bold"},"Configuración de Cuenta",-1))]),l("div",ce,[s(c,{outline:"",color:"primary",icon:"lock",label:"Cambiar Contraseña",onClick:o[11]||(o[11]=r=>e.showPasswordDialog=!0),class:"full-width","no-caps":""}),s(c,{outline:"",color:"negative",icon:"logout",label:"Cerrar Sesión",onClick:e.logout,class:"full-width","no-caps":""},null,8,["onClick"])])]),_:1})]),_:1}),s(w,{class:"status-card q-mt-md",flat:"",bordered:""},{default:i(()=>[s(p,null,{default:i(()=>[o[22]||(o[22]=l("div",{class:"text-h6 text-weight-bold q-mb-md"},"Estado de la Cuenta",-1)),l("div",fe,[l("div",we,[s(n,{name:e.user.email_verificado?"verified":"error",color:e.user.email_verificado?"positive":"negative",class:"q-mr-sm"},null,8,["name","color"]),l("span",null,"Email "+C(e.user.email_verificado?"Verificado":"No Verificado"),1)]),l("div",ge,[s(n,{name:"check_circle",color:"positive",class:"q-mr-sm"}),o[21]||(o[21]=l("span",null,"Cuenta Activa",-1))]),l("div",ve,[s(n,{name:"schedule",color:"info",class:"q-mr-sm"}),l("span",null,"Miembro desde "+C(e.formatDate(e.user.creado_en)),1)])])]),_:1})]),_:1})])]),s(I,{modelValue:e.showPasswordDialog,"onUpdate:modelValue":o[18]||(o[18]=r=>e.showPasswordDialog=r)},{default:i(()=>[s(w,{style:{"min-width":"400px"}},{default:i(()=>[s(p,{class:"row items-center"},{default:i(()=>[s(n,{name:"lock",size:"32px",color:"primary",class:"q-mr-sm"}),o[24]||(o[24]=l("span",{class:"text-h6"},"Cambiar Contraseña",-1))]),_:1}),s(p,null,{default:i(()=>[s(h,{onSubmit:e.changePassword,class:"q-gutter-md"},{default:i(()=>[s(d,{modelValue:e.passwordForm.current_password,"onUpdate:modelValue":o[13]||(o[13]=r=>e.passwordForm.current_password=r),type:e.showCurrentPassword?"text":"password",label:"Contraseña Actual",outlined:"",rules:[r=>!!r||"Ingresa tu contraseña actual"],"lazy-rules":""},{append:i(()=>[s(n,{name:e.showCurrentPassword?"visibility":"visibility_off",class:"cursor-pointer",onClick:o[12]||(o[12]=r=>e.showCurrentPassword=!e.showCurrentPassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),s(d,{modelValue:e.passwordForm.new_password,"onUpdate:modelValue":o[15]||(o[15]=r=>e.passwordForm.new_password=r),type:e.showNewPassword?"text":"password",label:"Nueva Contraseña",outlined:"",rules:e.passwordRules,"lazy-rules":""},{append:i(()=>[s(n,{name:e.showNewPassword?"visibility":"visibility_off",class:"cursor-pointer",onClick:o[14]||(o[14]=r=>e.showNewPassword=!e.showNewPassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),s(d,{modelValue:e.passwordForm.confirm_password,"onUpdate:modelValue":o[17]||(o[17]=r=>e.passwordForm.confirm_password=r),type:e.showConfirmPassword?"text":"password",label:"Confirmar Nueva Contraseña",outlined:"",rules:[r=>!!r||"Confirma la nueva contraseña",r=>r===e.passwordForm.new_password||"Las contraseñas no coinciden"],"lazy-rules":""},{append:i(()=>[s(n,{name:e.showConfirmPassword?"visibility":"visibility_off",class:"cursor-pointer",onClick:o[16]||(o[16]=r=>e.showConfirmPassword=!e.showConfirmPassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),l("div",be,[A(s(c,{flat:"",label:"Cancelar",color:"grey"},null,512),[[G]]),s(c,{unelevated:"",type:"submit",label:"Cambiar",color:"primary",loading:e.passwordLoading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ee=R(j,[["render",ye],["__scopeId","data-v-b5b7c9dc"]]);export{Ee as default};
